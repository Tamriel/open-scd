{"version":3,"file":"Historing.js","sourceRoot":"","sources":["../../src/Historing.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, TemplateResult } from 'lit';\nimport { state, property, query } from 'lit/decorators.js';\n\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { get, translate } from 'lit-translate';\n\nimport '@material/mwc-button';\nimport '@material/mwc-dialog';\nimport '@material/mwc-icon';\nimport '@material/mwc-icon-button';\nimport '@material/mwc-icon-button-toggle';\nimport '@material/mwc-list';\nimport '@material/mwc-list/mwc-list-item';\nimport '@material/mwc-snackbar';\nimport { Dialog } from '@material/mwc-dialog';\nimport { Snackbar } from '@material/mwc-snackbar';\n\nimport './filtered-list.js';\nimport {\n  CommitDetail,\n  CommitEntry,\n  InfoDetail,\n  InfoEntry,\n  invert,\n  IssueDetail,\n  IssueEvent,\n  LitElementConstructor,\n  LogEntry,\n  LogEntryType,\n  LogEvent,\n  Mixin,\n  newActionEvent,\n} from './foundation.js';\nimport { getFilterIcon, iconColors } from './icons/icons.js';\nimport { Plugin } from './open-scd.js';\n\nconst icons = {\n  info: 'info',\n  warning: 'warning',\n  error: 'report',\n};\n\nfunction getPluginName(src: string): string {\n  const plugin = <Plugin>(\n    JSON.parse(localStorage.getItem('plugins') ?? '[]').find(\n      (p: Plugin) => p.src === src\n    )\n  );\n  if (!plugin) return src;\n\n  const name = plugin.name;\n  return name || src;\n}\n\n/**\n * A mixin adding a `history` property to any `LitElement`, in which\n * incoming [[`LogEvent`]]s are logged.\n *\n * For [[`EditorAction`]] entries, also sets `editCount` to the index of\n * the committed action, allowing the user to go to `previousAction` with\n * `undo()` if `canUndo` and to go to `nextAction` with `redo()` if `canRedo`.\n *\n * Renders the `history` to `logUI` and the latest `'error'` [[`LogEntry`]] to\n * `messageUI`.\n */\nexport type HistoringElement = Mixin<typeof Historing>;\n\nexport function Historing<TBase extends LitElementConstructor>(Base: TBase) {\n  class HistoringElement extends Base {\n    /** All [[`LogEntry`]]s received so far through [[`LogEvent`]]s. */\n    @property({ type: Array })\n    log: InfoEntry[] = [];\n\n    /** All [[`CommitEntry`]]s received so far through [[`LogEvent`]]s */\n    @property({ type: Array })\n    history: CommitEntry[] = [];\n\n    /** Index of the last [[`EditorAction`]] applied. */\n    @property({ type: Number })\n    editCount = -1;\n    @property()\n    diagnoses = new Map<string, IssueDetail[]>();\n    @state()\n    latestIssue!: IssueDetail;\n\n    @query('#log') logUI!: Dialog;\n    @query('#history') historyUI!: Dialog;\n    @query('#diagnostic') diagnosticUI!: Dialog;\n    @query('#error') errorUI!: Snackbar;\n    @query('#warning') warningUI!: Snackbar;\n    @query('#info') infoUI!: Snackbar;\n    @query('#issue') issueUI!: Snackbar;\n\n    get canUndo(): boolean {\n      return this.editCount >= 0;\n    }\n    get canRedo(): boolean {\n      return this.nextAction >= 0;\n    }\n\n    get previousAction(): number {\n      if (!this.canUndo) return -1;\n      return this.history\n        .slice(0, this.editCount)\n        .map(entry => (entry.kind == 'action' ? true : false))\n        .lastIndexOf(true);\n    }\n    get nextAction(): number {\n      let index = this.history\n        .slice(this.editCount + 1)\n        .findIndex(entry => entry.kind == 'action');\n      if (index >= 0) index += this.editCount + 1;\n      return index;\n    }\n\n    private onIssue(de: IssueEvent): void {\n      const issues = this.diagnoses.get(de.detail.validatorId);\n\n      if (!issues) this.diagnoses.set(de.detail.validatorId, [de.detail]);\n      else issues?.push(de.detail);\n\n      this.latestIssue = de.detail;\n      this.issueUI.close();\n      this.issueUI.show();\n    }\n\n    undo(): boolean {\n      if (!this.canUndo) return false;\n      this.dispatchEvent(\n        newActionEvent(\n          invert((<CommitEntry>this.history[this.editCount]).action)\n        )\n      );\n      this.editCount = this.previousAction;\n      return true;\n    }\n    redo(): boolean {\n      if (!this.canRedo) return false;\n      this.dispatchEvent(\n        newActionEvent((<CommitEntry>this.history[this.nextAction]).action)\n      );\n      this.editCount = this.nextAction;\n      return true;\n    }\n\n    private onHistory(detail: CommitDetail) {\n      const entry: CommitEntry = {\n        time: new Date(),\n        ...detail,\n      };\n\n      if (entry.kind === 'action') {\n        if (entry.action.derived) return;\n        entry.action.derived = true;\n        if (this.nextAction !== -1) this.history.splice(this.nextAction);\n        this.editCount = this.history.length;\n      }\n\n      this.history.push(entry);\n      this.requestUpdate('history', []);\n    }\n\n    private onReset() {\n      this.log = [];\n      this.history = [];\n      this.editCount = -1;\n    }\n\n    private onInfo(detail: InfoDetail) {\n      const entry: InfoEntry = {\n        time: new Date(),\n        ...detail,\n      };\n\n      this.log.push(entry);\n      if (!this.logUI.open) {\n        const ui = {\n          error: this.errorUI,\n          warning: this.warningUI,\n          info: this.infoUI,\n        }[detail.kind];\n\n        ui.close();\n        ui.show();\n      }\n      if (detail.kind == 'error') {\n        this.errorUI.close(); // hack to reset timeout\n        this.errorUI.show();\n      }\n      this.requestUpdate('log', []);\n    }\n\n    private onLog(le: LogEvent): void {\n      switch (le.detail.kind) {\n        case 'reset':\n          this.onReset();\n          break;\n        case 'action':\n          this.onHistory(le.detail);\n          break;\n        default:\n          this.onInfo(le.detail);\n          break;\n      }\n    }\n    /*\n    async performUpdate() {\n      await new Promise<void>(resolve =>\n        requestAnimationFrame(() => resolve())\n      );\n      return super.performUpdate();\n    }\n*/\n\n    connectedCallback() {\n      super.connectedCallback();\n\n      this.undo = this.undo.bind(this);\n      this.redo = this.redo.bind(this);\n      this.onLog = this.onLog.bind(this);\n\n      this.addEventListener('log', this.onLog);\n      this.addEventListener('issue', this.onIssue);\n    }\n\n    renderLogEntry(\n      entry: InfoEntry,\n      index: number,\n      log: LogEntry[]\n    ): TemplateResult {\n      return html` <abbr title=\"${entry.title}\">\n        <mwc-list-item\n          class=\"${entry.kind}\"\n          graphic=\"icon\"\n          ?twoline=${!!entry.message}\n          ?activated=${this.editCount == log.length - index - 1}\n        >\n          <span>\n            <!-- FIXME: replace tt with mwc-chip asap -->\n            <tt>${entry.time?.toLocaleString()}</tt>\n            ${entry.title}</span\n          >\n          <span slot=\"secondary\">${entry.message}</span>\n          <mwc-icon\n            slot=\"graphic\"\n            style=\"--mdc-theme-text-icon-on-background:var(${ifDefined(\n              iconColors[entry.kind]\n            )})\"\n            >${icons[entry.kind]}</mwc-icon\n          >\n        </mwc-list-item></abbr\n      >`;\n    }\n\n    renderHistoryEntry(\n      entry: CommitEntry,\n      index: number,\n      history: LogEntry[]\n    ): TemplateResult {\n      return html` <abbr title=\"${entry.title}\">\n        <mwc-list-item\n          class=\"${entry.kind}\"\n          graphic=\"icon\"\n          ?twoline=${!!entry.message}\n          ?activated=${this.editCount == history.length - index - 1}\n        >\n          <span>\n            <!-- FIXME: replace tt with mwc-chip asap -->\n            <tt>${entry.time?.toLocaleString()}</tt>\n            ${entry.title}</span\n          >\n          <span slot=\"secondary\">${entry.message}</span>\n          <mwc-icon\n            slot=\"graphic\"\n            style=\"--mdc-theme-text-icon-on-background:var(${ifDefined(\n              iconColors[entry.kind]\n            )})\"\n            >history</mwc-icon\n          >\n        </mwc-list-item></abbr\n      >`;\n    }\n\n    private renderLog(): TemplateResult[] | TemplateResult {\n      if (this.log.length > 0)\n        return this.log.slice().reverse().map(this.renderLogEntry, this);\n      else\n        return html`<mwc-list-item disabled graphic=\"icon\">\n          <span>${translate('log.placeholder')}</span>\n          <mwc-icon slot=\"graphic\">info</mwc-icon>\n        </mwc-list-item>`;\n    }\n\n    private renderHistory(): TemplateResult[] | TemplateResult {\n      if (this.history.length > 0)\n        return this.history\n          .slice()\n          .reverse()\n          .map(this.renderHistoryEntry, this);\n      else\n        return html`<mwc-list-item disabled graphic=\"icon\">\n          <span>${translate('history.placeholder')}</span>\n          <mwc-icon slot=\"graphic\">info</mwc-icon>\n        </mwc-list-item>`;\n    }\n\n    private renderIssueEntry(issue: IssueDetail): TemplateResult {\n      return html` <abbr title=\"${issue.title + '\\n' + issue.message}\"\n        ><mwc-list-item ?twoline=${!!issue.message}>\n          <span> ${issue.title}</span>\n          <span slot=\"secondary\">${issue.message}</span>\n        </mwc-list-item></abbr\n      >`;\n    }\n\n    renderValidatorsIssues(issues: IssueDetail[]): TemplateResult[] {\n      if (issues.length === 0) return [html``];\n      return [\n        html`<mwc-list-item noninteractive\n          >${getPluginName(issues[0].validatorId)}</mwc-list-item\n        >`,\n        html`<li divider padded role=\"separator\"></li>`,\n        ...issues.map(issue => this.renderIssueEntry(issue)),\n      ];\n    }\n\n    private renderIssues(): TemplateResult[] | TemplateResult {\n      const issueItems: TemplateResult[] = [];\n\n      this.diagnoses.forEach(issues => {\n        this.renderValidatorsIssues(issues).forEach(issueItem =>\n          issueItems.push(issueItem)\n        );\n      });\n\n      return issueItems.length\n        ? issueItems\n        : html`<mwc-list-item disabled graphic=\"icon\">\n            <span>${translate('diag.placeholder')}</span>\n            <mwc-icon slot=\"graphic\">info</mwc-icon>\n          </mwc-list-item>`;\n    }\n\n    private renderFilterButtons() {\n      return (<LogEntryType[]>Object.keys(icons)).map(\n        kind => html`<mwc-icon-button-toggle id=\"${kind}filter\" on\n          >${getFilterIcon(kind, false)}\n          ${getFilterIcon(kind, true)}</mwc-icon-button-toggle\n        >`\n      );\n    }\n\n    private renderLogDialog(): TemplateResult {\n      return html` <mwc-dialog id=\"log\" heading=\"${translate('log.name')}\">\n        ${this.renderFilterButtons()}\n        <mwc-list id=\"content\" wrapFocus>${this.renderLog()}</mwc-list>\n        <mwc-button slot=\"primaryAction\" dialogaction=\"close\"\n          >${translate('close')}</mwc-button\n        >\n      </mwc-dialog>`;\n    }\n\n    private renderHistoryDialog(): TemplateResult {\n      return html` <mwc-dialog\n        id=\"history\"\n        heading=\"${translate('history.name')}\"\n      >\n        <mwc-list id=\"content\" wrapFocus>${this.renderHistory()}</mwc-list>\n        <mwc-button\n          icon=\"undo\"\n          label=\"${translate('undo')}\"\n          ?disabled=${!this.canUndo}\n          @click=${this.undo}\n          slot=\"secondaryAction\"\n        ></mwc-button>\n        <mwc-button\n          icon=\"redo\"\n          label=\"${translate('redo')}\"\n          ?disabled=${!this.canRedo}\n          @click=${this.redo}\n          slot=\"secondaryAction\"\n        ></mwc-button>\n        <mwc-button slot=\"primaryAction\" dialogaction=\"close\"\n          >${translate('close')}</mwc-button\n        >\n      </mwc-dialog>`;\n    }\n\n    render(): TemplateResult {\n      return html`${super.render()}\n        <style>\n          #log > mwc-icon-button-toggle {\n            position: absolute;\n            top: 8px;\n            right: 14px;\n          }\n          #log > mwc-icon-button-toggle:nth-child(2) {\n            right: 62px;\n          }\n          #log > mwc-icon-button-toggle:nth-child(3) {\n            right: 110px;\n          }\n          #log > mwc-icon-button-toggle:nth-child(4) {\n            right: 158px;\n          }\n          #content mwc-list-item.info,\n          #content mwc-list-item.warning,\n          #content mwc-list-item.error {\n            display: none;\n          }\n          #infofilter[on] ~ #content mwc-list-item.info {\n            display: flex;\n          }\n          #warningfilter[on] ~ #content mwc-list-item.warning {\n            display: flex;\n          }\n          #errorfilter[on] ~ #content mwc-list-item.error {\n            display: flex;\n          }\n\n          #infofilter[on] {\n            color: var(--cyan);\n          }\n\n          #warningfilter[on] {\n            color: var(--yellow);\n          }\n\n          #errorfilter[on] {\n            color: var(--red);\n          }\n\n          #actionfilter[on] {\n            color: var(--blue);\n          }\n\n          #log,\n          #history {\n            --mdc-dialog-min-width: 92vw;\n          }\n\n          #log > #filterContainer {\n            position: absolute;\n            top: 14px;\n            right: 14px;\n          }\n        </style>\n        ${this.renderLogDialog()} ${this.renderHistoryDialog()}\n        <mwc-dialog id=\"diagnostic\" heading=\"${translate('diag.name')}\">\n          <filtered-list id=\"content\" wrapFocus\n            >${this.renderIssues()}</filtered-list\n          >\n          <mwc-button slot=\"primaryAction\" dialogaction=\"close\"\n            >${translate('close')}</mwc-button\n          >\n        </mwc-dialog>\n\n        <mwc-snackbar\n          id=\"info\"\n          timeoutMs=\"4000\"\n          labelText=\"${this.log\n            .slice()\n            .reverse()\n            .find(le => le.kind === 'info')?.title ??\n          get('log.snackbar.placeholder')}\"\n        >\n          <mwc-icon-button icon=\"close\" slot=\"dismiss\"></mwc-icon-button>\n        </mwc-snackbar>\n        <mwc-snackbar\n          id=\"warning\"\n          timeoutMs=\"6000\"\n          labelText=\"${this.log\n            .slice()\n            .reverse()\n            .find(le => le.kind === 'warning')?.title ??\n          get('log.snackbar.placeholder')}\"\n        >\n          <mwc-button\n            slot=\"action\"\n            icon=\"history\"\n            @click=${() => this.logUI.show()}\n            >${translate('log.snackbar.show')}</mwc-button\n          >\n          <mwc-icon-button icon=\"close\" slot=\"dismiss\"></mwc-icon-button>\n        </mwc-snackbar>\n        <mwc-snackbar\n          id=\"error\"\n          timeoutMs=\"10000\"\n          labelText=\"${this.log\n            .slice()\n            .reverse()\n            .find(le => le.kind === 'error')?.title ??\n          get('log.snackbar.placeholder')}\"\n        >\n          <mwc-button\n            slot=\"action\"\n            icon=\"history\"\n            @click=${() => this.logUI.show()}\n            >${translate('log.snackbar.show')}</mwc-button\n          >\n          <mwc-icon-button icon=\"close\" slot=\"dismiss\"></mwc-icon-button>\n        </mwc-snackbar>\n        <mwc-snackbar\n          id=\"issue\"\n          timeoutMs=\"10000\"\n          labelText=\"${this.latestIssue?.title ??\n          get('log.snackbar.placeholder')}\"\n        >\n          <mwc-button\n            slot=\"action\"\n            icon=\"rule\"\n            @click=${() => this.diagnosticUI.show()}\n            >${translate('log.snackbar.show')}</mwc-button\n          >\n          <mwc-icon-button icon=\"close\" slot=\"dismiss\"></mwc-icon-button>\n        </mwc-snackbar>`;\n    }\n  }\n\n  return HistoringElement;\n}\n"]}