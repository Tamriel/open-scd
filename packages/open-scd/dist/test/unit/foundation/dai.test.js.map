{"version":3,"file":"dai.test.js","sourceRoot":"","sources":["../../../../test/unit/foundation/dai.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { expect } from '@open-wc/testing';\nimport {\n  createTemplateStructure,\n  determineUninitializedStructure,\n  initializeElements,\n} from '../../../src/foundation/dai.js';\n\ndescribe('Global DAI related functions including', () => {\n  let doc: Document;\n\n  beforeEach(async () => {\n    doc = await fetch('/test/testfiles/valid2007B4withIEDModifications.scd')\n      .then(response => response.text())\n      .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n  });\n\n  describe('determineUninitializedStructure', () => {\n    it('Full path needs to be initiated', () => {\n      const lnElement = doc.querySelector(\n        'LDevice[inst=\"CircuitBreaker_CB1\"] > LN0[lnType=\"Dummy.LLN0\"]'\n      );\n      const doElement = doc.querySelector(\n        'LNodeType[id=\"Dummy.LLN0\"] > DO[name=\"Mod\"]'\n      );\n      const daElement = doc.querySelector(\n        'DOType[id=\"Dummy.LLN0.Mod\"] > DA[name=\"stVal\"]'\n      );\n\n      const [parentElement, templateStructure] =\n        determineUninitializedStructure(lnElement!, [doElement!, daElement!]);\n\n      expect(parentElement?.tagName).to.be.equals('LN0');\n      expect(templateStructure.length).to.be.equals(2);\n      expect(templateStructure[0].tagName).to.be.equals('DO');\n      expect(templateStructure[1].tagName).to.be.equals('DA');\n    });\n\n    it('Full path needs to be initiated, including a structure', () => {\n      const lnElement = doc.querySelector(\n        'LDevice[inst=\"CircuitBreaker_CB1\"] > LN0[lnType=\"Dummy.LLN0\"]'\n      );\n      const doElement = doc.querySelector(\n        'LNodeType[id=\"Dummy.LLN0\"] > DO[name=\"ExtendedMod\"]'\n      );\n      const daElement = doc.querySelector(\n        'DOType[id=\"Dummy.LLN0.ExtendedMod\"] > DA[name=\"SBOw\"]'\n      );\n      const bdaElement = doc.querySelector(\n        'DAType[id=\"Dummy.LLN0.Mod.SBOw\"] > BDA[name=\"ctlVal\"]'\n      );\n\n      const [parentElement, templateStructure] =\n        determineUninitializedStructure(lnElement!, [\n          doElement!,\n          daElement!,\n          bdaElement!,\n        ]);\n\n      expect(parentElement?.tagName).to.be.equals('LN0');\n      expect(templateStructure.length).to.be.equals(3);\n      expect(templateStructure[0].tagName).to.be.equals('DO');\n      expect(templateStructure[1].tagName).to.be.equals('DA');\n      expect(templateStructure[2].tagName).to.be.equals('BDA');\n    });\n\n    it('Partial path needs to be initiated', () => {\n      const lnElement = doc.querySelector(\n        'LDevice[inst=\"CircuitBreaker_CB1\"] > LN[lnType=\"Dummy.XCBR1\"]'\n      );\n      const doElement = doc.querySelector(\n        'LNodeType[id=\"Dummy.XCBR1\"] > DO[name=\"Pos\"]'\n      );\n      const daElement = doc.querySelector(\n        'DOType[id=\"Dummy.XCBR1.Pos\"] > DA[name=\"stVal\"]'\n      );\n\n      const [parentElement, templateStructure] =\n        determineUninitializedStructure(lnElement!, [doElement!, daElement!]);\n\n      expect(parentElement?.tagName).to.be.equals('DOI');\n      expect(templateStructure.length).to.be.equals(1);\n      expect(templateStructure[0].tagName).to.be.equals('DA');\n    });\n  });\n\n  describe('createTemplateStructure', async () => {\n    it('creates DO/DA structure for LSVS supervision', async () => {\n      const lsvsScl: XMLDocument = await fetch(\n        '/test/testfiles/editors/LaterBindingSMV-LSVS.scd'\n      )\n        .then(response => response.text())\n        .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n      const lnElement = lsvsScl.querySelector(\n        'IED[name=\"SMV_Subscriber2\"] LN[lnClass=\"LSVS\"][inst=\"2\"]'\n      )!;\n      const structureOfElements = createTemplateStructure(lnElement, [\n        'SvCBRef',\n        'setSrcRef',\n      ]);\n\n      expect(structureOfElements?.length).to.be.equals(2);\n      expect(structureOfElements?.at(0)?.tagName).to.be.equals('DO');\n      expect(structureOfElements?.at(1)?.tagName).to.be.equals('DA');\n    });\n    it('creates DO/DA structure for LGOS supervision', async () => {\n      const lsvsScl: XMLDocument = await fetch(\n        '/test/testfiles/editors/LaterBindingGOOSE-LGOS.scd'\n      )\n        .then(response => response.text())\n        .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n      const lnElement = lsvsScl.querySelector(\n        'IED[name=\"GOOSE_Subscriber2\"] LN[lnClass=\"LGOS\"][inst=\"1\"]'\n      )!;\n\n      const structureOfElements = createTemplateStructure(lnElement, [\n        'GoCBRef',\n        'setSrcRef',\n      ]);\n\n      expect(structureOfElements?.length).to.be.equals(2);\n      expect(structureOfElements?.at(0)?.tagName).to.be.equals('DO');\n      expect(structureOfElements?.at(1)?.tagName).to.be.equals('DA');\n    });\n  });\n\n  describe('initializeElements', () => {\n    it('Simple creation (DOI/DAI)', () => {\n      const doElement = doc.querySelector(\n        'LNodeType[id=\"Dummy.LLN0\"] > DO[name=\"Mod\"]'\n      );\n      const daElement = doc.querySelector(\n        'DOType[id=\"Dummy.LLN0.Mod\"] > DA[name=\"stVal\"]'\n      );\n\n      const newElement = initializeElements([doElement!, daElement!]);\n\n      expect(newElement?.tagName).to.be.equals('DOI');\n      expect(newElement?.childNodes.length).to.be.equals(1);\n      expect((<Element>newElement?.firstChild).tagName).to.be.equals('DAI');\n      expect(newElement?.firstChild?.childNodes.length).to.be.equals(1);\n      expect(\n        (<Element>newElement?.firstChild?.firstChild).tagName\n      ).to.be.equals('Val');\n    });\n\n    it('Creation of structure (DOI/SDI/DAI)', () => {\n      const doElement = doc.querySelector(\n        'LNodeType[id=\"Dummy.LLN0\"] > DO[name=\"ExtendedMod\"]'\n      );\n      const daElement = doc.querySelector(\n        'DOType[id=\"Dummy.LLN0.ExtendedMod\"] > DA[name=\"SBOw\"]'\n      );\n      const bdaElement = doc.querySelector(\n        'DAType[id=\"Dummy.LLN0.Mod.SBOw\"] > BDA[name=\"ctlVal\"]'\n      );\n\n      const newElement = initializeElements([\n        doElement!,\n        daElement!,\n        bdaElement!,\n      ]);\n\n      expect(newElement?.tagName).to.be.equals('DOI');\n      expect(newElement?.childNodes.length).to.be.equals(1);\n      expect((<Element>newElement?.firstChild).tagName).to.be.equals('SDI');\n      expect(newElement?.firstChild?.childNodes.length).to.be.equals(1);\n      expect(\n        (<Element>newElement?.firstChild?.firstChild).tagName\n      ).to.be.equals('DAI');\n      expect(\n        newElement?.firstChild?.firstChild?.childNodes.length\n      ).to.be.equals(1);\n      expect(\n        (<Element>newElement?.firstChild?.firstChild?.firstChild).tagName\n      ).to.be.equals('Val');\n    });\n\n    it('Only create DAI', () => {\n      const daElement = doc.querySelector(\n        'DOType[id=\"Dummy.XCBR1.Pos\"] > DA[name=\"stVal\"]'\n      );\n\n      const newElement = initializeElements([daElement!]);\n\n      expect(newElement?.tagName).to.be.equals('DAI');\n      expect(newElement?.childNodes.length).to.be.equals(1);\n      expect((<Element>newElement?.firstChild).tagName).to.be.equals('Val');\n    });\n  });\n});\n"]}