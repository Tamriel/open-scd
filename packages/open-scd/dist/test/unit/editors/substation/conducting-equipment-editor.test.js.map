{"version":3,"file":"conducting-equipment-editor.test.js","sourceRoot":"","sources":["../../../../../test/unit/editors/substation/conducting-equipment-editor.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { fixture, html, expect } from '@open-wc/testing';\nimport { SinonSpy, spy } from 'sinon';\n\nimport '../../../../src/editors/substation/conducting-equipment-editor.js';\nimport { ConductingEquipmentEditor } from '../../../../src/editors/substation/conducting-equipment-editor.js';\nimport { isDelete } from '../../../../src/foundation.js';\n\ndescribe('conducting-equipment-editor', () => {\n  let element: ConductingEquipmentEditor;\n  let validSCL: XMLDocument;\n\n  let wizardEvent: SinonSpy;\n  let actionEvent: SinonSpy;\n\n  beforeEach(async () => {\n    validSCL = await fetch('/test/testfiles/valid2007B4.scd')\n      .then(response => response.text())\n      .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\n    element = <ConductingEquipmentEditor>(\n      await fixture(\n        html`<conducting-equipment-editor\n          .element=${validSCL.querySelector('ConductingEquipment')}\n        ></conducting-equipment-editor>`\n      )\n    );\n\n    wizardEvent = spy();\n    window.addEventListener('wizard', wizardEvent);\n    actionEvent = spy();\n    window.addEventListener('editor-action', actionEvent);\n  });\n\n  describe('rendered as action icon', () => {\n    beforeEach(async () => {\n      element.showfunctions = false;\n      await element.requestUpdate();\n    });\n\n    it('looks like the latest snapshot', async () => {\n      await expect(element).shadowDom.to.equalSnapshot();\n    });\n\n    it('renders empty string in case ConductingEquipment name attribute is missing', async () => {\n      const condEq = validSCL.querySelector('ConductingEquipment');\n      condEq?.removeAttribute('name');\n      await element.requestUpdate();\n\n      expect(element).to.have.property('name', '');\n    });\n\n    it('triggers edit wizard for LNode element on action button click', async () => {\n      (<HTMLElement>(\n        element.shadowRoot?.querySelector('mwc-fab[icon=\"account_tree\"]')\n      )).click();\n\n      await element.requestUpdate();\n\n      expect(wizardEvent).to.have.be.calledOnce;\n      expect(wizardEvent.args[0][0].detail.wizard()[0].title).to.contain(\n        'lnode'\n      );\n    });\n\n    it('triggers edit wizard for ConductingEquipment element on action button click', async () => {\n      (<HTMLElement>(\n        element.shadowRoot?.querySelector('mwc-fab[icon=\"edit\"]')\n      )).click();\n\n      await element.requestUpdate();\n\n      expect(wizardEvent).to.have.be.calledOnce;\n      expect(wizardEvent.args[0][0].detail.wizard()[0].title).to.contain(\n        'edit'\n      );\n    });\n\n    it('triggers remove action on action button click', async () => {\n      (<HTMLElement>(\n        element.shadowRoot?.querySelector('mwc-fab[icon=\"delete\"]')\n      )).click();\n\n      await element.requestUpdate();\n\n      expect(wizardEvent).to.not.have.been.called;\n      expect(actionEvent).to.have.been.calledOnce;\n      expect(actionEvent.args[0][0].detail.action).to.satisfy(isDelete);\n    });\n  });\n\n  describe('rendered as action pane', () => {\n    beforeEach(async () => {\n      element.showfunctions = true;\n      await element.requestUpdate();\n    });\n\n    it('looks like the latest snapshot', async () => {\n      await expect(element).shadowDom.to.equalSnapshot();\n    });\n\n    describe('with EqFunction children', () => {\n      beforeEach(async () => {\n        const doc = await fetch('/test/testfiles/zeroline/functions.scd')\n          .then(response => response.text())\n          .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\n        element.element = doc.querySelector(\n          'Bay[name=\"COUPLING_BAY\"] > ConductingEquipment[name=\"QA1\"]'\n        )!;\n        await element.requestUpdate();\n      });\n\n      it('looks like the latest snapshot', async () =>\n        await expect(element).shadowDom.to.equalSnapshot());\n    });\n\n    describe('with LNode children', () => {\n      beforeEach(async () => {\n        const doc = await fetch('/test/testfiles/zeroline/functions.scd')\n          .then(response => response.text())\n          .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\n        element.element = doc.querySelector(\n          'Bay[name=\"COUPLING_BAY\"] > ConductingEquipment[name=\"QC9\"]'\n        )!;\n        await element.requestUpdate();\n      });\n\n      it('looks like the latest snapshot', async () =>\n        await expect(element).shadowDom.to.equalSnapshot());\n    });\n\n    describe('with SubEquipment children', () => {\n      beforeEach(async () => {\n        const doc = await fetch('/test/testfiles/SubEquipment.scd')\n          .then(response => response.text())\n          .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\n        element.element = doc.querySelector('ConductingEquipment[name=\"QA1\"]')!;\n        await element.requestUpdate();\n      });\n\n      it('looks like the latest snapshot', async () => {\n        await expect(element).shadowDom.to.equalSnapshot();\n      });\n    });\n\n    it('renders empty string in case ConductingEquipment name attribute is missing', async () => {\n      const condEq = validSCL.querySelector('ConductingEquipment');\n      condEq?.removeAttribute('name');\n      await element.requestUpdate();\n\n      expect(element).to.have.property('name', '');\n    });\n\n    it('triggers edit wizard for LNode element on action button click', async () => {\n      (<HTMLElement>(\n        element.shadowRoot?.querySelector(\n          'mwc-icon-button[icon=\"account_tree\"]'\n        )\n      )).click();\n\n      await element.requestUpdate();\n\n      expect(wizardEvent).to.have.be.calledOnce;\n      expect(wizardEvent.args[0][0].detail.wizard()[0].title).to.contain(\n        'lnode'\n      );\n    });\n\n    it('triggers edit wizard for ConductingEquipment element on action button click', async () => {\n      (<HTMLElement>(\n        element.shadowRoot?.querySelector('mwc-icon-button[icon=\"edit\"]')\n      )).click();\n\n      await element.requestUpdate();\n\n      expect(wizardEvent).to.have.be.calledOnce;\n      expect(wizardEvent.args[0][0].detail.wizard()[0].title).to.contain(\n        'edit'\n      );\n    });\n\n    it('triggers remove action on action button click', async () => {\n      (<HTMLElement>(\n        element.shadowRoot?.querySelector('mwc-icon-button[icon=\"delete\"]')\n      )).click();\n\n      await element.requestUpdate();\n\n      expect(wizardEvent).to.not.have.been.called;\n      expect(actionEvent).to.have.been.calledOnce;\n      expect(actionEvent.args[0][0].detail.action).to.satisfy(isDelete);\n    });\n  });\n});\n"]}