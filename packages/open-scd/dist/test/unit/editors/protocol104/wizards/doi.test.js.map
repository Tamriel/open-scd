{"version":3,"file":"doi.test.js","sourceRoot":"","sources":["../../../../../../test/unit/editors/protocol104/wizards/doi.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { expect, fixture, html } from '@open-wc/testing';\nimport { SinonSpy, spy } from 'sinon';\n\nimport '../../../../../src/addons/Wizards.js';\nimport { Wizards } from '../../../../../src/addons/Wizards.js';\n\nimport { ComplexAction, isSimple } from '../../../../../src/foundation.js';\n\nimport {\n  remove104Private,\n  showDOIInfoWizard,\n} from '../../../../../src/editors/protocol104/wizards/doi.js';\n\nimport { fetchDoc } from '../../../wizards/test-support.js';\n\ndescribe('Wizards for 104 DOI Element', () => {\n  let doc: XMLDocument;\n  let doiElement: Element;\n  let element: Wizards;\n\n  beforeEach(async () => {\n    doc = await fetchDoc('/test/testfiles/104/valid-addresses.scd');\n    element = await fixture(\n      html`<oscd-wizards .host=${document}></oscd-wizards>`\n    );\n  });\n\n  describe('show 104 DOI Basic Info (Known CDC Monitor Only)', () => {\n    beforeEach(async () => {\n      doiElement = doc.querySelector(\n        'IED[name=\"B1\"] LN[lnType=\"SE_GAPC_SET_V001\"] DOI[name=\"Op\"]'\n      )!;\n\n      const wizard = showDOIInfoWizard(doiElement);\n      element.workflow.push(() => wizard);\n      await element.requestUpdate();\n    });\n\n    it('looks like the latest snapshot', async () => {\n      await expect(element.wizardUI.dialog).dom.to.equalSnapshot();\n    });\n  });\n\n  describe('show 104 DOI Basic Info with ctlModel (Known CDC Monitor and Control)', () => {\n    beforeEach(async () => {\n      doiElement = doc.querySelector(\n        'IED[name=\"B1\"] LN[lnType=\"SE_GGIO_SET_V002\"] DOI[name=\"CmdBlk\"]'\n      )!;\n\n      const wizard = showDOIInfoWizard(doiElement);\n      element.workflow.push(() => wizard);\n      await element.requestUpdate();\n    });\n\n    it('looks like the latest snapshot', async () => {\n      await expect(element.wizardUI.dialog).dom.to.equalSnapshot();\n    });\n  });\n\n  describe('show 104 DOI Basic Info for CDC=ACD', () => {\n    beforeEach(async () => {\n      doiElement = doc.querySelector(\n        'IED[name=\"B1\"] LN[lnType=\"SE_GAPC_SET_V001\"] DOI[name=\"Str\"]'\n      )!;\n\n      const doElement = doc\n        .querySelector('LNodeType[id=\"SE_GAPC_SET_V001\"] > DO[name=\"Str\"]')\n        ?.getAttribute('type')!;\n\n      expect(doElement).to.be.equal('SE_ACD_V001');\n\n      const doType = doc.querySelector(`DOType[id=\"${doElement}\"]`)!;\n      expect(doType.getAttribute('cdc')).to.be.equal('ACD');\n\n      const wizard = showDOIInfoWizard(doiElement);\n      element.workflow.push(() => wizard);\n      await element.requestUpdate();\n    });\n\n    it('looks like the latest snapshot', async () => {\n      await expect(element.wizardUI.dialog).dom.to.equalSnapshot();\n    });\n  });\n\n  describe('show 104 DOI Basic Info for CDC=DEL', () => {\n    beforeEach(async () => {\n      doiElement = doc.querySelector(\n        'IED[name=\"B1\"] LN[lnType=\"SE_MMXU_SET_V001\"] DOI[name=\"PPV\"]'\n      )!;\n\n      const doElement = doc\n        .querySelector('LNodeType[id=\"SE_MMXU_SET_V001\"] > DO[name=\"PPV\"]')\n        ?.getAttribute('type')!;\n\n      expect(doElement).to.be.equal('SE_DEL_V001');\n      const doType = doc.querySelector(`DOType[id=\"${doElement}\"]`)!;\n      expect(doType.getAttribute('cdc')).to.be.equal('DEL');\n    });\n  });\n\n  describe('remove104Private', () => {\n    let wizard: Element;\n    let actionEvent: SinonSpy;\n\n    beforeEach(async () => {\n      // We just need some element as Wizard for dispatching.\n      wizard = document.firstElementChild!;\n\n      actionEvent = spy();\n      wizard.addEventListener('editor-action', actionEvent);\n    });\n\n    function expectComplexAction(expectedActions: number) {\n      expect(actionEvent).to.be.calledOnce;\n      const action = actionEvent.args[0][0].detail.action;\n      expect(action).to.not.satisfy(isSimple);\n      const complexAction = <ComplexAction>action;\n      expect(complexAction.actions.length).to.be.equal(expectedActions);\n    }\n\n    it('expected one Private Element to be removed', () => {\n      doiElement = doc.querySelector(\n        'IED[name=\"B1\"] LN[lnType=\"SE_GGIO_SET_V002\"] DOI[name=\"SPCSO1\"]'\n      )!;\n\n      remove104Private(doiElement)(wizard);\n\n      expectComplexAction(1);\n    });\n\n    it('expected multiple Private Elements to be removed', () => {\n      doiElement = doc.querySelector(\n        'IED[name=\"B1\"] LN[lnType=\"SE_GGIO_SET_V002\"] DOI[name=\"Mod\"]'\n      )!;\n\n      remove104Private(doiElement)(wizard);\n\n      expectComplexAction(6);\n    });\n  });\n});\n"]}