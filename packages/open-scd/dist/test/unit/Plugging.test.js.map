{"version":3,"file":"Plugging.test.js","sourceRoot":"","sources":["../../../test/unit/Plugging.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { expect, fixture, html } from '@open-wc/testing';\n\nimport '../mock-open-scd.js';\nimport { MockOpenSCD } from '../mock-open-scd.js';\n\nimport { TextField } from '@material/mwc-textfield';\n\ndescribe('OpenSCD-Plugin', () => {\n  let element: MockOpenSCD;\n  let doc: XMLDocument;\n  const docName = 'testDoc';\n\n  afterEach(async () => {\n    await new Promise(resolve => setTimeout(resolve, 50)); // await animation\n    localStorage.clear();\n  });\n  beforeEach(async () => {\n    doc = await fetch('/test/testfiles/valid2007B4.scd')\n      .then(response => response.text())\n      .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n    element = <MockOpenSCD>(\n      await fixture(\n        html`<mock-open-scd .doc=${doc} .docName=${docName}></mock-open-scd>`\n      )\n    );\n    await element.updateComplete;\n  });\n\n  it('stores default plugins on load', () =>\n    expect(element).property('editors').to.have.lengthOf(6));\n\n  it('has Locale property', async () => {\n    expect(element).to.have.property('locale');\n  });\n\n  it('has docs property', () => {\n    expect(element).to.have.property(`docs`).that.is.a('Object');\n    expect(element.docs[docName]).to.equal(doc);\n  });\n\n  describe('plugin manager dialog', () => {\n    let firstEditorPlugin: HTMLElement;\n    let resetAction: HTMLElement;\n    let primaryAction: HTMLElement;\n\n    beforeEach(async () => {\n      element.pluginUI.show();\n      await element.pluginUI.updateComplete;\n      firstEditorPlugin = <HTMLElement>(\n        element.pluginList.querySelector(\n          'mwc-check-list-item:not([noninteractive])'\n        )\n      );\n\n      resetAction = <HTMLElement>(\n        element.pluginUI.querySelector('mwc-button[slot=\"secondaryAction\"]')\n      );\n      primaryAction = <HTMLElement>(\n        element.pluginUI.querySelector('mwc-button[slot=\"primaryAction\"]')\n      );\n      await element.updateComplete;\n    });\n\n    it('disables deselected plugins', async () => {\n      firstEditorPlugin.click();\n      await element.updateComplete;\n      expect(element).property('editors').to.have.lengthOf(5);\n    });\n\n    it('enables selected plugins', async () => {\n      (<HTMLElement>element.pluginList.firstElementChild).click();\n      await element.updateComplete;\n      (<HTMLElement>element.pluginList.firstElementChild).click();\n      await element.updateComplete;\n      expect(element).property('editors').to.have.lengthOf(6);\n    });\n\n    it('resets plugins to default on reset button click', async () => {\n      (<HTMLElement>element.pluginList.firstElementChild).click();\n      await element.updateComplete;\n      resetAction.click();\n      await element.updateComplete;\n      expect(element).property('editors').to.have.lengthOf(6);\n    });\n\n    it('opens the custom plugin dialog on add button click', async () => {\n      primaryAction.click();\n      await element.updateComplete;\n      expect(element)\n        .property('pluginDownloadUI')\n        .to.have.property('open', true);\n    });\n  });\n\n  describe('add custom plugin dialog', () => {\n    let src: TextField;\n    let name: TextField;\n    let primaryAction: HTMLElement;\n    let menuKindOption: HTMLElement;\n    let validatorKindOption: HTMLElement;\n\n    beforeEach(async () => {\n      src = <TextField>(\n        element.pluginDownloadUI.querySelector('#pluginSrcInput')\n      );\n      name = <TextField>(\n        element.pluginDownloadUI.querySelector('#pluginNameInput')\n      );\n      primaryAction = <HTMLElement>(\n        element.pluginDownloadUI.querySelector(\n          'mwc-button[slot=\"primaryAction\"]'\n        )\n      );\n      element.pluginDownloadUI.show();\n      await element.pluginDownloadUI.updateComplete;\n      menuKindOption = <HTMLElement>(\n        element.pluginDownloadUI.querySelector(\n          '#pluginKindList > mwc-radio-list-item[id=\"menu\"]'\n        )\n      );\n      validatorKindOption = <HTMLElement>(\n        element.pluginDownloadUI.querySelector(\n          '#pluginKindList > mwc-radio-list-item[id=\"validator\"]'\n        )\n      );\n    });\n\n    it('requires a name and a valid URL to add a plugin', async () => {\n      primaryAction.click();\n      expect(element.pluginDownloadUI).to.have.property('open', true);\n\n      src.value = 'http://example.com/plugin.js';\n      await src.updateComplete;\n      primaryAction.click();\n      expect(element.pluginDownloadUI).to.have.property('open', true);\n\n      src.value = 'notaURL';\n      name.value = 'testName';\n      await src.updateComplete;\n      await name.updateComplete;\n      primaryAction.click();\n      expect(element.pluginDownloadUI).to.have.property('open', true);\n\n      src.value = 'http://example.com/plugin.js';\n      await src.updateComplete;\n      primaryAction.click();\n      expect(element.pluginDownloadUI).to.have.property('open', false);\n    });\n\n    it('adds a new editor kind plugin on add button click', async () => {\n      src.value = 'http://example.com/plugin.js';\n      name.value = 'testName';\n      await src.updateComplete;\n      await name.updateComplete;\n      primaryAction.click();\n      await new Promise(resolve => setTimeout(resolve, 50)); // await animation\n\n      await element.requestUpdate();\n      await element.updateComplete;\n\n      expect(element.editors).to.have.lengthOf(7);\n    });\n\n    it('adds a new menu kind plugin on add button click', async () => {\n      const lengthMenuKindPlugins = element.menuEntries.length;\n      src.value = 'http://example.com/plugin.js';\n      name.value = 'testName';\n      menuKindOption.click();\n      await src.updateComplete;\n      await name.updateComplete;\n      primaryAction.click();\n      await element.updateComplete;\n      expect(element.menuEntries).to.have.lengthOf(lengthMenuKindPlugins + 1);\n    });\n    it('sets requireDoc and position for new menu kind plugin', async () => {\n      src.value = 'http://example.com/plugin.js';\n      name.value = 'testName';\n      menuKindOption.click();\n      await src.updateComplete;\n      await name.updateComplete;\n      primaryAction.click();\n      await element.updateComplete;\n\n      expect(\n        element.menuEntries[element.menuEntries.length - 1]\n      ).to.have.property('requireDoc');\n      expect(\n        element.menuEntries[element.menuEntries.length - 1]\n      ).to.have.property('position');\n    });\n    it('adds a new validator kind plugin on add button click', async () => {\n      expect(element.validators).to.have.lengthOf(2);\n      src.value = 'http://example.com/plugin.js';\n      name.value = 'testName';\n      validatorKindOption.click();\n      await src.updateComplete;\n      await name.updateComplete;\n      primaryAction.click();\n      await element.updateComplete;\n      expect(element.validators).to.have.lengthOf(3);\n    });\n  });\n});\n"]}