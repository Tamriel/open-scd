{"version":3,"file":"UpdateDescritionABB.test.js","sourceRoot":"","sources":["../../../../test/unit/menu/UpdateDescritionABB.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { expect, fixture, html } from '@open-wc/testing';\nimport sinon, { SinonSpy } from 'sinon';\n\nimport '../../mock-open-scd.js';\nimport { MockOpenSCD } from '../../mock-open-scd.js';\n\nimport { ComplexAction, isSimple, isReplace } from '../../../src/foundation.js';\nimport UpdateDescriptionAbb from '../../../src/menu/UpdateDescriptionABB.js';\n\ndescribe('Update method for desc attributes in ABB IEDs', () => {\n  if (customElements.get('update-description-abb') === undefined)\n    customElements.define('update-description-abb', UpdateDescriptionAbb);\n\n  let parent: MockOpenSCD;\n  let element: UpdateDescriptionAbb;\n\n  let editorAction: SinonSpy;\n\n  beforeEach(async () => {\n    parent = await fixture(html`\n      <mock-open-scd\n        ><update-description-abb></update-description-abb\n      ></mock-open-scd>\n    `);\n\n    element = parent.getActivePlugin();\n\n    editorAction = sinon.spy();\n    window.addEventListener('editor-action', editorAction);\n  });\n\n  describe('working on SCL files without manufacturer ABB', () => {\n    beforeEach(async () => {\n      const doc = await fetch('/test/testfiles/validators/zeroissues.scd')\n        .then(response => response.text())\n        .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n      element.doc = doc;\n      element.run();\n      await parent.requestUpdate();\n    });\n\n    it('creates an empty wizard indicating not found desc updates', async () => {\n      await expect(parent.wizardUI.dialog).to.equalSnapshot();\n    });\n  });\n\n  describe('working on SCL files containing manufacturer ABB', () => {\n    beforeEach(async () => {\n      const doc = await fetch('/test/testfiles/updatedesc/updatedescABB.scd')\n        .then(response => response.text())\n        .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n      element.doc = doc;\n      element.run();\n      await parent.requestUpdate();\n    });\n\n    it('creates a wizard with all valid desc update possibilities', async () => {\n      await expect(parent.wizardUI.dialog).to.equalSnapshot();\n    });\n    it('creates wizard that on save triggers a complex action containing selected desc updates', async () => {\n      parent.wizardUI?.dialog\n        ?.querySelector<HTMLElement>('mwc-button[slot=\"primaryAction\"]')!\n        .click();\n      await parent.updateComplete;\n      expect(editorAction).to.have.been.calledOnce;\n      expect(editorAction.args[0][0].detail.action).to.not.satisfy(isSimple);\n      const complexAction = <ComplexAction>(\n        editorAction.args[0][0].detail.action\n      );\n      expect(complexAction.actions.length).to.equal(2);\n      for (const action of complexAction.actions)\n        expect(action).to.satisfy(isReplace);\n    });\n  });\n});\n"]}