{"version":3,"file":"dai.test.js","sourceRoot":"","sources":["../../../../test/unit/wizards/dai.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { expect, fixture, html } from '@open-wc/testing';\n\nimport '../../../src/addons/Wizards.js';\nimport { Wizards } from '../../../src/addons/Wizards.js';\n\nimport { WizardTextField } from '../../../src/wizard-textfield.js';\nimport {\n  ComplexAction,\n  Create,\n  isSimple,\n  Replace,\n  WizardAction,\n  WizardInputElement,\n} from '../../../src/foundation.js';\n\nimport { fetchDoc, setWizardTextFieldValue } from './test-support.js';\nimport {\n  createDAIWizard,\n  createValue,\n  editDAIWizard,\n  updateValue,\n} from '../../../src/wizards/dai.js';\n\ndescribe('Wizards for SCL element DAI', () => {\n  let doc: XMLDocument;\n  let doi: Element;\n  let dai: Element;\n  let da: Element;\n  let element: Wizards;\n  let inputs: WizardInputElement[];\n\n  describe('create DAI with existing Val Element', () => {\n    beforeEach(async () => {\n      doc = await fetchDoc('/test/testfiles/wizards/ied.scd');\n      dai = doc.querySelector(\n        'IED[name=\"IED1\"] > AccessPoint[name=\"P1\"] > Server > LDevice[inst=\"CircuitBreaker_CB1\"] > LN[inst=\"1\"][lnClass=\"XCBR\"] > DOI[name=\"Beh\"] > DAI[name=\"integer\"]'\n      )!;\n      doi = dai.closest('DOI')!;\n      da = doc.querySelector(\n        'DOType[cdc=\"ENS\"][id=\"Dummy.LLN0.Beh\"] > DA[name=\"integer\"]'\n      )!;\n\n      element = await fixture(\n        html`<oscd-wizards .host=${document}></oscd-wizards>`\n      );\n      const wizard = createDAIWizard(doi, dai, da);\n      element.workflow.push(() => wizard);\n      await element.requestUpdate();\n      inputs = Array.from(element.wizardUI.inputs);\n    });\n\n    it('update value should be updated in document', async function () {\n      await setWizardTextFieldValue(<WizardTextField>inputs[0], '24');\n\n      const complexActions = createValue(\n        doi,\n        da,\n        dai,\n        dai\n      )(inputs, element.wizardUI);\n      expectCreateComplexAction(complexActions, '24');\n    });\n\n    it('looks like the latest snapshot', async () => {\n      await expect(element.wizardUI.dialog).dom.to.equalSnapshot();\n    });\n  });\n\n  describe('create DAI without Val Element', () => {\n    beforeEach(async () => {\n      doc = await fetchDoc('/test/testfiles/wizards/ied.scd');\n      dai = doc.querySelector(\n        'IED[name=\"IED1\"] > AccessPoint[name=\"P1\"] > Server > LDevice[inst=\"CircuitBreaker_CB1\"] > LN[inst=\"1\"][lnClass=\"XCBR\"] > DOI[name=\"Beh\"] > DAI[name=\"t\"]'\n      )!;\n      doi = dai.closest('DOI')!;\n      da = doc.querySelector(\n        'DOType[cdc=\"ENS\"][id=\"Dummy.LLN0.Beh\"] > DA[name=\"t\"]'\n      )!;\n\n      element = await fixture(\n        html`<oscd-wizards .host=${document}></oscd-wizards>`\n      );\n      const wizard = createDAIWizard(doi, dai, da);\n      element.workflow.push(() => wizard);\n      await element.requestUpdate();\n      inputs = Array.from(element.wizardUI.inputs);\n    });\n\n    it('update value should be updated in document', async function () {\n      await setWizardTextFieldValue(<WizardTextField>inputs[0], '');\n      await setWizardTextFieldValue(<WizardTextField>inputs[1], '');\n\n      const complexActions = createValue(\n        doi,\n        da,\n        dai,\n        dai\n      )(inputs, element.wizardUI);\n      expectCreateComplexAction(complexActions, '0000-00-00T00:00:00.000');\n    });\n\n    it('looks like the latest snapshot', async () => {\n      await expect(element.wizardUI.dialog).dom.to.equalSnapshot();\n    });\n  });\n\n  describe('edit existing DAI with Val Element', () => {\n    describe('having on value', () => {\n      let val: Element;\n\n      beforeEach(async () => {\n        doc = await fetchDoc('/test/testfiles/wizards/ied.scd');\n        dai = doc.querySelector(\n          'IED[name=\"IED1\"] > AccessPoint[name=\"P1\"] > Server > LDevice[inst=\"CircuitBreaker_CB1\"] > LN[prefix=\"CB\"][lnClass=\"CSWI\"] > DOI[name=\"Beh\"] > DAI[name=\"integer\"]'\n        )!;\n        val = dai.querySelector('Val')!;\n        da = doc.querySelector(\n          'DOType[cdc=\"ENS\"][id=\"Dummy.LLN0.Beh\"] > DA[name=\"integer\"]'\n        )!;\n\n        element = await fixture(\n          html`<oscd-wizards .host=${document}></oscd-wizards>`\n        );\n        const wizard = editDAIWizard(da, dai);\n        element.workflow.push(() => wizard);\n        await element.requestUpdate();\n        inputs = Array.from(element.wizardUI.inputs);\n      });\n\n      it('update value should be updated in document', async function () {\n        await setWizardTextFieldValue(<WizardTextField>inputs[0], '8');\n\n        const complexActions = updateValue(da, val)(inputs, element.wizardUI);\n        expectUpdateComplexAction(complexActions);\n\n        const replace = <Replace>(<ComplexAction>complexActions[0]).actions[0];\n        expect(replace.old.element.textContent).to.equal('5');\n        expect(replace.new.element.textContent).to.equal('8');\n      });\n\n      it('looks like the latest snapshot', async () => {\n        await expect(element.wizardUI.dialog).dom.to.equalSnapshot();\n      });\n    });\n\n    describe('having multiple setting group values', () => {\n      let val: Element;\n\n      beforeEach(async () => {\n        doc = await fetchDoc('/test/testfiles/wizards/settingGroups.scd');\n        dai = doc.querySelector(\n          ':root > IED[name=\"IED1\"] > AccessPoint[name=\"AP1\"] > Server > ' +\n            'LDevice[inst=\"stage2\"] > LN[lnType=\"OpenSCD_PTOC\"] > DOI[name=\"StrVal\"] > SDI[name=\"setMag\"] > DAI[name=\"f\"]'\n        )!;\n        val = dai.querySelectorAll('Val')[1];\n        da = doc.querySelector(\n          'DAType[id=\"OpenSCD_AnVal_FLOAT32\"] > BDA[name=\"f\"]'\n        )!;\n\n        element = await fixture(\n          html`<oscd-wizards .host=${document}></oscd-wizards>`\n        );\n        const wizard = editDAIWizard(da, dai);\n        element.workflow.push(() => wizard);\n        await element.requestUpdate();\n        inputs = Array.from(element.wizardUI.inputs);\n      });\n\n      it('update value should be updated in document', async function () {\n        await setWizardTextFieldValue(<WizardTextField>inputs[0], '800');\n\n        const complexActions = updateValue(da, val)(inputs, element.wizardUI);\n        expectUpdateComplexAction(complexActions);\n\n        const replace = <Replace>(<ComplexAction>complexActions[0]).actions[0];\n        expect(replace.old.element.textContent).to.equal('600');\n        expect(replace.new.element.textContent).to.equal('800');\n      });\n    });\n  });\n\n  function expectUpdateComplexAction(complexActions: WizardAction[]): void {\n    expect(complexActions.length).to.equal(1);\n    expect(complexActions[0]).to.not.satisfy(isSimple);\n\n    expect((<ComplexAction>complexActions[0]).title).to.equal(\n      '[dai.action.updatedai]'\n    );\n\n    const actions = (<ComplexAction>complexActions[0]).actions;\n    expect(actions.length).to.equal(1);\n  }\n\n  function expectCreateComplexAction(\n    complexActions: WizardAction[],\n    expectedValue: string\n  ): void {\n    expect(complexActions.length).to.equal(1);\n    expect(complexActions[0]).to.not.satisfy(isSimple);\n\n    expect((<ComplexAction>complexActions[0]).title).to.equal(\n      '[dai.action.createdai]'\n    );\n\n    const actions = (<ComplexAction>complexActions[0]).actions;\n    expect(actions.length).to.equal(1);\n\n    const create = <Create>actions[0];\n    expect(create.new.parent).to.equal(doi);\n    expect(create.new.element).to.equal(dai);\n\n    const val = dai.querySelector('Val')!;\n    expect(val.textContent).to.be.equal(expectedValue);\n  }\n});\n"]}