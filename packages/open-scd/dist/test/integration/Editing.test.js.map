{"version":3,"file":"Editing.test.js","sourceRoot":"","sources":["../../../test/integration/Editing.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { expect, fixture, html } from '@open-wc/testing';\n\nimport '../mock-editor-logger.js';\nimport { MockEditorLogger } from '../mock-editor-logger.js';\n\nimport {\n  createUpdateAction,\n  newActionEvent,\n  Update,\n} from '../../src/foundation.js';\n\ndescribe('Editing-Logging integration', () => {\n  let elm: MockEditorLogger;\n  let parent: Element;\n  let element: Element;\n\n  beforeEach(async () => {\n    const doc = await fetch('/test/testfiles/Editing.scd')\n      .then(response => response.text())\n      .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n    elm = <MockEditorLogger>(\n      await fixture(html`<mock-editor-logger .doc=${doc}></mock-editor-logger>`)\n    );\n\n    parent = elm.doc!.querySelector('VoltageLevel[name=\"E1\"]')!;\n    element = parent.querySelector('Bay[name=\"Q01\"]')!;\n  });\n\n  describe('has a Create EditorAction type that', () => {\n    let newElement: Element;\n    beforeEach(() => {\n      newElement = elm.doc!.createElement('Bay');\n      newElement?.setAttribute('name', 'Q03');\n    });\n\n    it('can be undone', () => {\n      elm.dispatchEvent(\n        newActionEvent({ new: { parent, element: newElement } })\n      );\n      expect(newElement.parentElement).to.equal(parent);\n\n      elm.undo();\n      expect(newElement.parentElement).to.be.null;\n    });\n\n    it('can be redone', () => {\n      elm.dispatchEvent(\n        newActionEvent({ new: { parent, element: newElement } })\n      );\n\n      elm.undo();\n\n      elm.redo();\n      expect(newElement.parentElement).to.equal(parent);\n    });\n\n    it('automatically assignes a missing reference on redo', () => {\n      elm.dispatchEvent(\n        newActionEvent({ new: { parent, element: newElement } })\n      );\n      elm.undo();\n\n      elm.redo();\n      expect(\n        parent.querySelector('Bay[name=\"Q03\"]')?.nextElementSibling\n      ).to.equal(parent.querySelector('Bay[name=\"Q01\"]'));\n    });\n\n    it('properly uses the reference on redo', () => {\n      const newElement = elm.doc!.createElement('Bay');\n      newElement?.setAttribute('name', 'Q03');\n\n      elm.dispatchEvent(\n        newActionEvent({\n          new: {\n            parent,\n            element: newElement,\n            reference: parent.lastChild,\n          },\n        })\n      );\n\n      elm.undo();\n\n      elm.redo();\n\n      expect(parent.querySelector('Bay[name=\"Q03\"]')?.nextSibling).to.equal(\n        parent.lastChild\n      );\n    });\n  });\n\n  describe('has a Delete EditorAction type that', () => {\n    it('can be ondone', () => {\n      expect(element.parentElement).to.equal(parent);\n\n      elm.dispatchEvent(\n        newActionEvent({\n          old: {\n            parent,\n            element,\n          },\n        })\n      );\n      expect(element.parentElement).to.be.null;\n\n      elm.undo();\n      expect(element.parentElement).to.equal(parent);\n    });\n\n    it('can be rodone', () => {\n      elm.dispatchEvent(\n        newActionEvent({\n          old: {\n            parent,\n            element,\n          },\n        })\n      );\n\n      elm.undo();\n\n      elm.redo();\n      expect(element.parentElement).to.be.null;\n    });\n\n    it('puts the deleted Node back to its original position on undo', () => {\n      const originalNextSibling = element.nextSibling;\n\n      elm.dispatchEvent(\n        newActionEvent({\n          old: {\n            parent,\n            element,\n          },\n        })\n      );\n      elm.undo();\n\n      expect(element.nextSibling).to.equal(originalNextSibling);\n    });\n  });\n\n  describe('has a Move EditorAction type that', () => {\n    let newParent: Element;\n    beforeEach(() => {\n      newParent = elm.doc!.querySelector('VoltageLevel[name=\"J1\"]')!;\n    });\n\n    it('can be undone', () => {\n      expect(element.parentElement).to.equal(parent);\n\n      elm.dispatchEvent(\n        newActionEvent({ old: { parent, element }, new: { parent: newParent } })\n      );\n      expect(element.parentElement).to.equal(newParent);\n\n      elm.undo();\n      expect(element.parentElement).to.equal(parent);\n    });\n\n    it('can be redone', () => {\n      elm.dispatchEvent(\n        newActionEvent({ old: { parent, element }, new: { parent: newParent } })\n      );\n\n      elm.undo();\n\n      elm.redo();\n      expect(element.parentElement).to.equal(newParent);\n    });\n\n    it('adds the element in a valid location in the new parent', () => {\n      elm.dispatchEvent(\n        newActionEvent({ old: { parent, element }, new: { parent: newParent } })\n      );\n      expect(\n        elm.doc!.querySelector('VoltageLevel[name=\"J1\"] > Bay[name=\"Q01\"]')\n          ?.nextElementSibling\n      ).to.equal(elm.doc!.querySelector('VoltageLevel[name=\"J1\"] > Function'));\n    });\n\n    it('puts the element back to its original postition with parent', () => {\n      elm.dispatchEvent(\n        newActionEvent({ old: { parent, element }, new: { parent: newParent } })\n      );\n\n      elm.undo();\n      expect(\n        parent.querySelector('Bay[name=\"Q01\"]')?.nextElementSibling\n      ).to.equal(parent.querySelector('Bay[name=\"Q02\"]'));\n    });\n  });\n\n  describe('has a Replace EditorAction type that', () => {\n    let newElement: Element;\n    beforeEach(() => {\n      newElement = elm.doc!.createElement('Bay');\n      newElement?.setAttribute('name', 'Q03');\n    });\n\n    it('can be undone', () => {\n      elm.dispatchEvent(\n        newActionEvent({ old: { element }, new: { element: newElement } })\n      );\n\n      elm.undo();\n      expect(newElement.parentElement).to.be.null;\n      expect(element.parentElement).to.equal(parent);\n    });\n\n    it('can be redone', () => {\n      elm.dispatchEvent(\n        newActionEvent({ old: { element }, new: { element: newElement } })\n      );\n\n      elm.undo();\n\n      elm.redo();\n\n      expect(newElement.parentElement).to.equal(parent);\n      expect(element.parentElement).to.be.null;\n    });\n\n    it('correctly copying child elements between element and newElement for multiple undo/redo', () => {\n      const originOldChildCount = element.children.length;\n      const originNewChildCount = newElement.children.length;\n\n      elm.dispatchEvent(\n        newActionEvent({ old: { element }, new: { element: newElement } })\n      );\n      expect(element.children).to.have.lengthOf(originNewChildCount);\n      expect(newElement.children).to.have.lengthOf(originOldChildCount);\n\n      elm.undo();\n      elm.redo();\n\n      elm.undo();\n      expect(element.children).to.have.lengthOf(originOldChildCount);\n      expect(newElement.children).to.have.lengthOf(originNewChildCount);\n\n      elm.redo();\n      expect(element.children).to.have.lengthOf(originNewChildCount);\n      expect(newElement.children).to.have.lengthOf(originOldChildCount);\n    });\n  });\n\n  describe('has an Update EditorAction type that', () => {\n    let updateAction: Update;\n    beforeEach(() => {\n      const newAttributes: Record<string, string | null> = {};\n      newAttributes['name'] = 'Q03';\n\n      updateAction = createUpdateAction(element, newAttributes);\n    });\n\n    it('can undo', () => {\n      elm.dispatchEvent(newActionEvent(updateAction));\n      expect(element).to.have.attribute('name', 'Q03');\n      expect(element).to.not.have.attribute('desc');\n\n      elm.undo();\n      expect(element).to.have.attribute('name', 'Q01');\n      expect(element).to.have.attribute('desc', 'Bay');\n    });\n\n    it('can redo', () => {\n      elm.dispatchEvent(newActionEvent(updateAction));\n\n      elm.undo();\n      elm.redo();\n\n      expect(element).to.have.attribute('name', 'Q03');\n      expect(element).to.not.have.attribute('desc');\n    });\n  });\n});\n"]}