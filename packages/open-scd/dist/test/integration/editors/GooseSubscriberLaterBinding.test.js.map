{"version":3,"file":"GooseSubscriberLaterBinding.test.js","sourceRoot":"","sources":["../../../../test/integration/editors/GooseSubscriberLaterBinding.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { expect, fixture, html } from '@open-wc/testing';\nimport { TemplateResult, html as litHTML } from 'lit';\nimport { customElement, query } from 'lit/decorators.js';\n\nimport '../../mock-open-scd.js';\n\nimport GooseSubscriberLaterBinding from '../../../src/editors/GooseSubscriberLaterBinding.js';\nimport {\n  getExtrefLaterBindingList,\n  getFCDABindingList,\n  getSelectedSubItemValue,\n  selectFCDAItem,\n} from './test-support.js';\nimport { ExtRefLaterBindingList } from '../../../src/editors/subscription/later-binding/ext-ref-later-binding-list.js';\nimport { MockOpenSCD } from '../../mock-open-scd.js';\n\ncustomElements.define(\n  'goose-subscriber-later-binding-plugin',\n  GooseSubscriberLaterBinding\n);\n@customElement('goose-mock-open-scd')\nclass GooseMockOpenSCD extends MockOpenSCD {\n  @query('goose-subscriber-later-binding-plugin')\n  plugin!: GooseSubscriberLaterBinding;\n\n  renderHosting(): TemplateResult {\n    return litHTML`<goose-subscriber-later-binding-plugin\n      .doc=${this.doc}\n      .editCount=${this.editCount}\n      .nsdoc=${this.nsdoc}\n    ></goose-subscriber-later-binding-plugin>`;\n  }\n}\n\ndescribe('GOOSE Subscribe Later Binding Plugin', () => {\n  let element: GooseSubscriberLaterBinding;\n  let parent: GooseMockOpenSCD;\n  let doc: XMLDocument;\n\n  beforeEach(async () => {\n    doc = await fetch('/test/testfiles/editors/LaterBindingGOOSE2007B4.scd')\n      .then(response => response.text())\n      .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\n    parent = await fixture(\n      html`<goose-mock-open-scd .doc=${doc}></goose-mock-open-scd>`\n    );\n    await parent.updateComplete;\n    element = parent.plugin;\n    await element.updateComplete;\n  });\n\n  it('when selecting an FCDA element with subscriptions it looks like the latest snapshot', async () => {\n    doc = await fetch('/test/testfiles/editors/LaterBindingGOOSE-LGOS.scd')\n      .then(response => response.text())\n      .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\n    parent = await fixture(\n      html`<mock-open-scd\n        ><goose-subscriber-later-binding-plugin\n          .doc=\"${doc}\"\n        ></goose-subscriber-later-binding-plugin\n      ></mock-open-scd>`\n    );\n    element = parent.getActivePlugin();\n\n    const fcdaListElement = getFCDABindingList(element);\n    selectFCDAItem(\n      fcdaListElement,\n      'GOOSE_Publisher>>QB2_Disconnector>GOOSE2',\n      'GOOSE_Publisher>>QB2_Disconnector>GOOSE2sDataSet>QB2_Disconnector/ CSWI 1.Pos stVal (ST)'\n    );\n    await element.requestUpdate();\n\n    const extRefListElement = <ExtRefLaterBindingList>(\n      element.shadowRoot?.querySelector('extref-later-binding-list')\n    );\n    await extRefListElement.requestUpdate();\n\n    await expect(extRefListElement).shadowDom.to.equalSnapshot();\n  });\n\n  it('when subscribing an available ExtRef then the lists are changed', async () => {\n    const fcdaListElement = getFCDABindingList(element);\n    const extRefListElement = getExtrefLaterBindingList(element);\n\n    selectFCDAItem(\n      fcdaListElement,\n      'GOOSE_Publisher>>QB2_Disconnector>GOOSE1',\n      'GOOSE_Publisher>>QB2_Disconnector>GOOSE1sDataSet>QB1_Disconnector/ CSWI 1.Pos q (ST)'\n    );\n    await element.requestUpdate();\n    await extRefListElement.requestUpdate();\n\n    expect(\n      extRefListElement['getSubscribedExtRefElements']().length\n    ).to.be.equal(0);\n    expect(getSelectedSubItemValue(fcdaListElement)).to.be.null;\n    expect(\n      extRefListElement['getAvailableExtRefElements']().length\n    ).to.be.equal(5);\n\n    (<HTMLElement>(\n      extRefListElement.shadowRoot!.querySelector(\n        'mwc-list-item[value=\"GOOSE_Subscriber>>Earth_Switch> CILO 1>Pos;CSWI1/Pos/stVal[0]\"]'\n      )\n    )).click();\n    await element.requestUpdate();\n    await parent.updateComplete;\n\n    expect(\n      extRefListElement['getSubscribedExtRefElements']().length\n    ).to.be.equal(1);\n    expect(getSelectedSubItemValue(fcdaListElement)).to.have.text('1');\n    expect(\n      extRefListElement['getAvailableExtRefElements']().length\n    ).to.be.equal(4);\n  });\n\n  it('when subscribing an available ExtRef then a supervision instance is created', async () => {\n    doc = await fetch('/test/testfiles/editors/LaterBindingGOOSE-LGOS.scd')\n      .then(response => response.text())\n      .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\n    parent = await fixture(\n      html`<goose-mock-open-scd .doc=${doc}\n      ></goosemock-open-scd>`\n    );\n    await parent.updateComplete;\n    element = parent.plugin;\n    await element.updateComplete;\n\n    const extRefListElement = getExtrefLaterBindingList(element);\n\n    const fcdaListElement = getFCDABindingList(element);\n    selectFCDAItem(\n      fcdaListElement,\n      'GOOSE_Publisher2>>QB2_Disconnector>GOOSE1',\n      'GOOSE_Publisher2>>QB2_Disconnector>GOOSE1sDataSet>QB1_Disconnector/ CSWI 1.Pos stVal (ST)'\n    );\n    await element.requestUpdate();\n    await extRefListElement.requestUpdate();\n\n    (<HTMLElement>(\n      extRefListElement.shadowRoot!.querySelector(\n        'mwc-list-item[value=\"GOOSE_Subscriber1>>Earth_Switch> CILO 1>Pos;CSWI1/Pos/stVal[0]\"]'\n      )\n    )).click();\n    await element.requestUpdate();\n\n    const supervisionInstance = element.doc.querySelector(\n      'IED[name=\"GOOSE_Subscriber1\"] LN[lnClass=\"LGOS\"][inst=\"4\"]'\n    );\n    expect(supervisionInstance).to.exist;\n    expect(\n      supervisionInstance?.previousElementSibling?.getAttribute('lnClass')\n    ).to.equal('LGOS');\n    expect(\n      supervisionInstance?.previousElementSibling?.getAttribute('inst')\n    ).to.equal('3');\n  });\n\n  it('when unsubscribing a subscribed ExtRef then the lists are changed', async () => {\n    const fcdaListElement = getFCDABindingList(element);\n    const extRefListElement = getExtrefLaterBindingList(element);\n\n    selectFCDAItem(\n      fcdaListElement,\n      'GOOSE_Publisher>>QB2_Disconnector>GOOSE2',\n      'GOOSE_Publisher>>QB2_Disconnector>GOOSE2sDataSet>QB2_Disconnector/ CSWI 1.Pos q (ST)'\n    );\n    await element.requestUpdate();\n    await extRefListElement.requestUpdate();\n\n    expect(\n      extRefListElement['getSubscribedExtRefElements']().length\n    ).to.be.equal(2);\n    expect(getSelectedSubItemValue(fcdaListElement)).to.have.text('2');\n    expect(\n      extRefListElement['getAvailableExtRefElements']().length\n    ).to.be.equal(5);\n\n    (<HTMLElement>(\n      extRefListElement.shadowRoot!.querySelector(\n        'mwc-list-item[value=\"GOOSE_Subscriber>>Earth_Switch> CSWI 1>Pos;CSWI1/Pos/q[0]\"]'\n      )\n    )).click();\n    await element.requestUpdate();\n    await parent.updateComplete;\n\n    expect(\n      extRefListElement['getSubscribedExtRefElements']().length\n    ).to.be.equal(1);\n    expect(getSelectedSubItemValue(fcdaListElement)).to.have.text('1');\n    expect(\n      extRefListElement['getAvailableExtRefElements']().length\n    ).to.be.equal(6);\n  });\n});\n"]}